<html xmlns:concordion="http://www.concordion.org/2007/concordion">
<body>
    <h1>Message Recovery</h1>

    <p>
    If message synchronization is required, the initiator sends a
    <i>ResendRequest</i> message to initiate the retransmission of messages.
    <sup><a href="#ref-1">[1]</a></sup> The acceptor can respond in the
    following three ways: <sup><a href="#ref-2">[2]</a></sup>
    </p>

    <p>
    1. Retransmit the requested messages (in order) with the original
    sequence numbers and <i>PossDupFlag</i> set to "Y".
    </p>

    <div class="example">
        <h3>Example</h3>
        <p>
        The initiator detects a sequence number gap and sends a
        <i>ResendRequest</i> message to the acceptor. The acceptor resends
        the messages after which synchronization is
        <span concordion:assertEquals="messagesAreResent()">not required</span>.
        </p>
    </div>

    <p>
    2. Issue a <i>SeqReset-GapFill with PossDupFlag set to "Y"</i> message to
    replace the retransmission of administrative and application messages.
    </p>

    <div class="example">
        <h3>Example</h3>
        <p>
	The initiator, while expecting <i>MsgSeqNum</i> of the next received
        message to be 1, receives a message with <i>MsgSeqNum</i> set to
	<span concordion:set="#outOfOrderSeqNum">3</span>. To fill the sequence
	number gap, the initiator sends a <i>ResendRequest</i> message to the
        acceptor.
        </p>
        <p>
	The acceptor responds with a <i>SeqReset-GapFill</i> message with
	<i>MsgSeqNum</i> set to <span concordion:set="#replyMsgSeqNum">1</span>
	and <i>NewSeqNo</i> set to <span concordion:set="#newSeqNo">4</span>
        after which synchronization is
        <span concordion:assertEquals="seqResetGapFillReceived(#outOfOrderSeqNum, #replyMsgSeqNum, #newSeqNo)">not required</span>.
        </p>
    </div>

    <p>
    3. Issue a <i>SeqReset-Reset with PossDupFlag set to "Y"</i> to force
    sequence number synchronization.
    </p>

    <div class="example">
        <h3>Example</h3>
        <p>
	The initiator, while expecting <i>MsgSeqNum</i> of the next received
        message to be 1, receives a message with <i>MsgSeqNum</i> set to
	<span concordion:set="#outOfOrderSeqNum">3</span>. To fill the sequence
	number gap, the initiator sends a <i>ResendRequest</i> message to the
        acceptor.
        </p>
        <p>
	The acceptor responds with a <i>SeqReset-GapFill</i> message with
	<i>MsgSeqNum</i> set to <span concordion:set="#replyMsgSeqNum">4</span>
	and <i>NewSeqNo</i> set to <span concordion:set="#newSeqNo">5</span>
        after which synchronization is
        <span concordion:assertEquals="seqResetResetReceived(#outOfOrderSeqNum, #replyMsgSeqNum, #newSeqNo)">not required</span>.
        </p>
    </div>

    <h2>References</h2>

    <ol>
       <a name="ref-1" /><li><a href="http://www.fixengine.org/specifications/fix4.3spec">FIX 4.3 Specification with Errata 20020920</a> - Volume 2, pages 20 ("Resend Request")</li>
       <a name="ref-2" /><li><a href="http://www.fixengine.org/specifications/fix4.3spec">FIX 4.3 Specification with Errata 20020920</a> - Volume 2, pages 9-10 ("Message Recovery")</li>
    </ol>
</body>
</html>
